<html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Jest | Painless JavaScript Unit Testing</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="Jest | Painless JavaScript Unit Testing"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/jest/index.html"><meta property="og:image" content="http://facebook.github.io/jest/img/opengraph.png"><meta property="og:description" content="Painless JavaScript Unit Testing"><link rel="shortcut icon" href="/jest/img/favicon.png"><link rel="stylesheet" href="/jest/css/jest.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/jest/"><img src="/jest/img/jest_logo_nav.png">Jest</a><ul class="nav-site"><li><a href="/jest/docs/tutorial.html#content" class="active">docs</a></li><li><a href="/jest/support.html" class="">support</a></li><li><a href="http://github.com/facebook/jest" class="">github</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Quick Start</h3><ul><li><a style="margin-left:0;" class="" href="/jest/docs/getting-started.html#content">Getting Started</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/tutorial.html#content">Tutorial</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/tutorial-jquery.html#content">Tutorial – jQuery</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/tutorial-coffeescript.html#content">Tutorial – CoffeeScript</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/tutorial-react.html#content">Tutorial – React</a></li></ul></div><div class="nav-docs-section"><h3>Core Concepts</h3><ul><li><a style="margin-left:0;" class="" href="/jest/docs/common-js-testing.html#content">CommonJS Testing</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/automatic-mocking.html#content">Automatic Mocking</a></li></ul></div><div class="nav-docs-section"><h3>Reference</h3><ul><li><a style="margin-left:0;" class="" href="/jest/docs/mock-functions.html#content">Mock functions</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/manual-mocks.html#content">Manual mocks</a></li><li><a style="margin-left:0;" class="active" href="/jest/docs/timer-mocks.html#content">Timer mocks</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/api.html#content">API Reference</a></li></ul></div><div class="nav-docs-section"><h3>Complementary</h3><ul><li><a target="_blank" style="margin-left:0;" class="" href="http://facebook.github.io/react/">React – UI Library</a></li><li><a target="_blank" style="margin-left:0;" class="" href="http://facebook.github.io/flux/">Flux – Application Architecture</a></li></ul></div></div><div class="inner-content"><a id="content"></a><h1>Timer mocks</h1><div><p>The native timer functions (i.e., <code>setTimeout</code>, <code>setInterval</code>, <code>clearTimeout</code>,
<code>clearInterval</code>) are less than ideal for a testing environment since they depend
on real time to elapse. To resolve this issue, Jest provides you with mocked
timer functions and APIs that allow you to control the passage of time.
<a href="https://www.youtube.com/watch?v=5gVv10J4nio" target="_blank">Great Scott!</a></p><div class="prism language-javascript"><span class="token comment" spellcheck="true">// timerGame.js
</span><span class="token keyword">function</span> <span class="token function">timerGame<span class="token punctuation">(</span></span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">&#x27;Ready....go!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setTimeout<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">&quot;Time&#x27;s up -- stop!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    callback &amp;&amp; <span class="token function">callback<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> timerGame<span class="token punctuation">;</span></div><div class="prism language-javascript"><span class="token comment" spellcheck="true">// __tests__/timerGame-test.js
</span>jest<span class="token punctuation">.</span><span class="token function">dontMock<span class="token punctuation">(</span></span><span class="token string">&#x27;../timerGame&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe<span class="token punctuation">(</span></span><span class="token string">&#x27;timerGame&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">it<span class="token punctuation">(</span></span><span class="token string">&#x27;waits 1 second before ending the game&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> timerGame <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">&#x27;../timerGame&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">timerGame<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">expect<span class="token punctuation">(</span></span>setTimeout<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe<span class="token punctuation">(</span></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect<span class="token punctuation">(</span></span>setTimeout<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe<span class="token punctuation">(</span></span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><h2><a class="anchor" name="run-all-timers"></a>Run All Timers <a class="hash-link" href="#run-all-timers">#</a></h2><p>Another test we might want to write for this module is one that asserts that the
callback is called after 1 second. To do this, we&#x27;re going to use Jest&#x27;s timer
control APIs to fast-forward time right in the middle of the test:</p><div class="prism language-javascript">  <span class="token function">it<span class="token punctuation">(</span></span><span class="token string">&#x27;calls the callback after 1 second&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> timerGame <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">&#x27;../timerGame&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> callback <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">genMockFunction<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">timerGame<span class="token punctuation">(</span></span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true"> // At this point in time, the callback should not have been called yet
</span>    <span class="token function">expect<span class="token punctuation">(</span></span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toBeCalled<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true"> // Fast-forward until all timers have been executed
</span>    jest<span class="token punctuation">.</span><span class="token function">runAllTimers<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true"> // Now our callback should have been called!
</span>    <span class="token function">expect<span class="token punctuation">(</span></span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled<span class="token punctuation">(</span></span><span class="token punctuation">)</span>
    <span class="token function">expect<span class="token punctuation">(</span></span>callback<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe<span class="token punctuation">(</span></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><h2><a class="anchor" name="run-pending-timers"></a>Run Pending Timers <a class="hash-link" href="#run-pending-timers">#</a></h2><p>There are also scenarios where you might have a recursive timer -- that is a
timer that sets a new timer in its own callback. For these, running all the
timers would be an endless loop… so something like <code>jest.runAllTimers()</code> is not
desirable. For these cases you might use <code>jest.runOnlyPendingTimers()</code>:</p><div class="prism language-javascript"><span class="token comment" spellcheck="true">// infiniteTimerGame.js
</span><span class="token keyword">function</span> <span class="token function">infiniteTimerGame<span class="token punctuation">(</span></span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">&#x27;Ready....go!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setTimeout<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">&#x27;Times up! 10 seconds before the next game starts...&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    callback &amp;&amp; <span class="token function">callback<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true"> // Schedule the next game in 10 seconds
</span>    <span class="token function">setTimeout<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">infiniteTimerGame<span class="token punctuation">(</span></span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> infiniteTimerGame<span class="token punctuation">;</span></div><div class="prism language-javascript"><span class="token comment" spellcheck="true">// __tests__/infiniteTimerGame-test.js
</span>jest<span class="token punctuation">.</span><span class="token function">dontMock<span class="token punctuation">(</span></span><span class="token string">&#x27;../infiniteTimerGame&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe<span class="token punctuation">(</span></span><span class="token string">&#x27;infiniteTimerGame&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">it<span class="token punctuation">(</span></span><span class="token string">&#x27;schedules a 10-second timer after 1 second&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> infiniteTimerGame <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">&#x27;../infiniteTimerGame&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> callback <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">genMockFunction<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">infiniteTimerGame<span class="token punctuation">(</span></span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true"> // At this point in time, there should have been a single call to
</span>   <span class="token comment" spellcheck="true"> // setTimeout to schedule the end of the game in 1 second.
</span>    <span class="token function">expect<span class="token punctuation">(</span></span>setTimeout<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe<span class="token punctuation">(</span></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect<span class="token punctuation">(</span></span>setTimeout<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe<span class="token punctuation">(</span></span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true"> // Fast forward and exhaust only currently pending timers
</span>   <span class="token comment" spellcheck="true"> // (but not any new timers that get created during that process)
</span>    jest<span class="token punctuation">.</span><span class="token function">runOnlyPendingTimers<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true"> // At this point, our 1-second timer should have fired it&#x27;s callback
</span>    <span class="token function">expect<span class="token punctuation">(</span></span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true"> // And it should have created a new timer to start the game over in
</span>   <span class="token comment" spellcheck="true"> // 10 seconds
</span>    <span class="token function">expect<span class="token punctuation">(</span></span>setTimeout<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe<span class="token punctuation">(</span></span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect<span class="token punctuation">(</span></span>setTimeout<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe<span class="token punctuation">(</span></span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>Lastly, it may occasionally be useful in some tests to be able to clear all of
the pending timers. For this, we have <code>jest.clearTimers()</code>.</p></div><div class="docs-prevnext"><a class="docs-next" href="api.html#content">Next →</a></div></div></section><footer class="wrap"><div class="right">© 2014 Facebook Inc.</div></footer></div><div id="fb-root"></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-387204-10', 'facebook.github.io');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
          </script></body></html>