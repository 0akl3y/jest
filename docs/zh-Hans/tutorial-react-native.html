<html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/><title>Testing React Native Apps · Jest</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Testing React Native Apps · Jest"/><meta property="og:type" content="website"/><meta property="og:url" content="https://facebook.github.io/jest/index.html"/><meta property="og:description" content="At Facebook, we use Jest to test [React Native](http://facebook.github.io/react-native/) applications."/><meta property="og:image" content="/jest/img/opengraph.png"/><link rel="shortcut icon" href="/jest/img/favicon/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="/jest/css/main.css"/><link rel="alternate" type="application/atom+xml" href="https://facebook.github.io/blog/atom.xml" title="Jest Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://facebook.github.io/blog/feed.xml" title="Jest Blog RSS Feed"/><script async="" defer="" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/jest/"><img class="logo" src="/jest/img/jest.svg"/><h2 class="headerTitle">Jest</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/jest/docs/zh-Hans/getting-started.html" target="_self">文件</a></li><li><a href="/jest/docs/zh-Hans/api.html" target="_self">API</a></li><li><a href="/jest/zh-Hans/help.html" target="_self">帮助</a></li><li><a href="/jest/blog" target="_self">博客</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/jest/img/language.svg"/>简体中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/jest/en">English</a></li><li><a href="/jest/ja">日本語</a></li><li><a href="/jest/es-ES">Español</a></li><li><a href="/jest/pt-BR">Português (Brasil)</a></li><li><a href="/jest/ro">Română</a></li><li><a href="/jest/ru">Русский</a></li><li><a href="/jest/uk">Українська</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(){
          if(languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search"/></li><li><a href="https://github.com/facebook/jest" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Framework Guides</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Introduction</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/getting-started.html">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/using-matchers.html">Using Matchers</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/asynchronous.html">Testing Asynchronous Code</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/setup-teardown.html">Setup and Teardown</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/mock-functions.html">Mock Functions</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/more-resources.html">More Resources</a></li></ul></div><div class="navGroup navGroupActive"><h3>API Reference</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/api.html">Globals</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/expect.html">Expect</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/mock-function-api.html">Mock Functions</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/jest-object.html">The Jest Object</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/configuration.html">Configuring Jest</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/cli.html">Jest CLI Options</a></li></ul></div><div class="navGroup navGroupActive"><h3>Framework Guides</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/tutorial-react.html">Testing React Apps</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/jest/docs/zh-Hans/tutorial-react-native.html">Testing React Native Apps</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/testing-frameworks.html">Testing Web Frameworks</a></li></ul></div><div class="navGroup navGroupActive"><h3>Guides</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/snapshot-testing.html">快照测试</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/tutorial-async.html">An Async Example</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/timer-mocks.html">Timer Mocks</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/manual-mocks.html">Manual Mocks</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/webpack.html">Using with webpack</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/migration-guide.html">Migrating to Jest</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/zh-Hans/troubleshooting.html">Troubleshooting</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Testing React Native Apps</h1></header><article><div><span><p>At Facebook, we use Jest to test <a href="http://facebook.github.io/react-native/">React Native</a> applications.</p>
<p>Get a deeper insight into testing a working React Native app example by reading the following series: <a href="https://blog.callstack.io/unit-testing-react-native-with-the-new-jest-i-snapshots-come-into-play-68ba19b1b9fe#.12zbnbgwc">Part 1: Jest – Snapshot come into play</a> and <a href="https://blog.callstack.io/unit-testing-react-native-with-the-new-jest-ii-redux-snapshots-for-your-actions-and-reducers-8559f6f8050b">Part 2: Jest – Redux Snapshots for your Actions and Reducers</a>.</p>
<h2><a class="anchor" name=""></a>安装 <a class="hash-link" href="#">#</a></h2>
<p>Starting from react-native version 0.38, a Jest setup is included by default when running <code>react-native init</code>. The following configuration should be automatically added to your package.json file:</p>
<pre><code class="language-json">// package.json
  "scripts": {
    "test": "jest"
  },
  "jest": {
    "preset": "react-native"
  }
</code></pre>
<p><em>Note: If you are upgrading your react-native application and previously used the <code>jest-react-native</code> preset, remove the dependency from your <code>package.json</code> file and change the preset to <code>react-native</code> instead.</em></p>
<p>Simply run <code>npm test</code> to run tests with Jest.</p>
<h2><a class="anchor" name="snapshot-test"></a>Snapshot Test <a class="hash-link" href="#snapshot-test">#</a></h2>
<p>Let's create a <a href="/jest/docs/zh-Hans/snapshot-testing.html">snapshot test</a> for a small intro component with a few views and text components and some styles:</p>
<pre><code class="language-javascript"><span class="hljs-comment">// Intro.js</span>
<span class="hljs-keyword">import</span> React, {Component} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> {
  StyleSheet,
  Text,
  View,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>;

<span class="hljs-keyword">const</span> styles = StyleSheet.create({
  <span class="hljs-attr">container</span>: {
    <span class="hljs-attr">alignItems</span>: <span class="hljs-string">'center'</span>,
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#F5FCFF'</span>,
    <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">justifyContent</span>: <span class="hljs-string">'center'</span>,
  },
  <span class="hljs-attr">instructions</span>: {
    <span class="hljs-attr">color</span>: <span class="hljs-string">'#333333'</span>,
    <span class="hljs-attr">marginBottom</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">textAlign</span>: <span class="hljs-string">'center'</span>,
  },
  <span class="hljs-attr">welcome</span>: {
    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">margin</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">textAlign</span>: <span class="hljs-string">'center'</span>,
  },
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Intro</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
  render() {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.container}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.welcome}</span>&gt;</span>
          Welcome to React Native!
        <span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.instructions}</span>&gt;</span>
          This is a React Native snapshot test.
        <span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>
    );
  }
}
</code></pre>
<p>现在，使用React的test renderer和Jest的快照特性来和组件交互，获得渲染结果和生成快照文件：</p>
<pre><code class="language-javascript"><span class="hljs-comment">// __tests__/Intro-test.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'react-native'</span>;
<span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> Intro <span class="hljs-keyword">from</span> <span class="hljs-string">'../Intro'</span>;

<span class="hljs-comment">// Note: test renderer must be required after react-native.</span>
<span class="hljs-keyword">import</span> renderer <span class="hljs-keyword">from</span> <span class="hljs-string">'react-test-renderer'</span>;

test(<span class="hljs-string">'renders correctly'</span>, () =&gt; {
  <span class="hljs-keyword">const</span> tree = renderer.create(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Intro</span> /&gt;</span>
  ).toJSON();
  expect(tree).toMatchSnapshot();
});
</span></code></pre>
<p>当你运行<code>npm test</code>或者<code>jest</code>，将产生一个像下面的文件：</p>
<pre><code class="language-javascript"><span class="hljs-comment">// __tests__/__snapshots__/Intro-test.js.snap</span>
exports[<span class="hljs-string">`Intro renders correctly 1`</span>] = <span class="hljs-string">`
&lt;View
  style={
    Object {
      "alignItems": "center",
      "backgroundColor": "#F5FCFF",
      "flex": 1,
      "justifyContent": "center",
    }
  }&gt;
  &lt;Text
    style={
      Object {
        "fontSize": 20,
        "margin": 10,
        "textAlign": "center",
      }
    }&gt;
    Welcome to React Native!
  &lt;/Text&gt;
  &lt;Text
    style={
      Object {
        "color": "#333333",
        "marginBottom": 5,
        "textAlign": "center",
      }
    }&gt;
    This is a React Native snapshot test.
  &lt;/Text&gt;
&lt;/View&gt;
`</span>;
</code></pre>
<p>下次你运行测试时，渲染的结果将会和之前创建的快照进行比较。 代码变动时快照必须按顺序提交。 当快照测试失败，你需要去检查是否是你想要或不想要的变动。 如果变动符合预期，你可以通过<code>jest -u</code>调用Jest从而重写存在的快照。</p>
<p>The code for this example is available at <a href="https://github.com/facebook/jest/tree/master/examples/react-native">examples/react-native</a>.</p>
<h2><a class="anchor" name="preset-configuration"></a>Preset configuration <a class="hash-link" href="#preset-configuration">#</a></h2>
<p>The preset sets up the environment and is very opinionated and based on what we found to be useful at Facebook. All of the configuration options can be overwritten just as they can be customized when no preset is used.</p>
<h3><a class="anchor" name="environment"></a>Environment <a class="hash-link" href="#environment">#</a></h3>
<p><code>react-native</code> ships with a Jest preset, so the <code>jest.preset</code> field of your <code>package.json</code> should point to <code>react-native</code>. The preset is a node environment that mimics the environment of a React Native app. Because it doesn't load any DOM or browser APIs, it greatly improves Jest's startup time.</p>
<h3><a class="anchor" name="transformignorepatterns-customization"></a>transformIgnorePatterns customization <a class="hash-link" href="#transformignorepatterns-customization">#</a></h3>
<p>The <a href="configuration.html#transformignorepatterns-array-string"><code>transformIgnorePatterns</code></a> option can be used to whitelist or blacklist files from being transformed with babel. Many react-native npm modules unfortunately don't pre-compile their source code before publishing.</p>
<p>By default the jest-react-native preset only processes the project's own source files and react-native. If you have npm dependencies that have to be transformed you can customize this configuration option by whitelisting modules other than react-native:</p>
<pre><code class="language-json">"transformIgnorePatterns": [
  "node_modules/(?!(react-native|my-project|react-native-button)/)"
]
</code></pre>
<h3><a class="anchor" name="setupfiles"></a>setupFiles <a class="hash-link" href="#setupfiles">#</a></h3>
<p>If you'd like to provide additional configuration for every test file, the <a href="configuration.html#setupfiles-array"><code>setupFiles</code> configuration option</a> can be used to specify setup scripts.</p>
<h3><a class="anchor" name="modulenamemapper"></a>moduleNameMapper <a class="hash-link" href="#modulenamemapper">#</a></h3>
<p>The <a href="configuration.html#modulenamemapper-object-string-string"><code>moduleNameMapper</code></a> can be used to map a module path to a different module. By default the preset maps all images to an image stub module but if a module cannot be found this configuration option can help:</p>
<pre><code class="language-json">"moduleNameMapper": {
  "my-module.js": "&lt;rootDir&gt;/path/to/my-module.js"
}
</code></pre>
<h2><a class="anchor" name="tips"></a>Tips <a class="hash-link" href="#tips">#</a></h2>
<h3><a class="anchor" name="mock-native-modules-using-jestmock"></a>Mock native modules using jest.mock <a class="hash-link" href="#mock-native-modules-using-jestmock">#</a></h3>
<p>The Jest preset built into <code>react-native</code> comes with a few default mocks that are applied on a react-native repository. However some react-native components or third party components rely on native code to be rendered. In such cases, Jest's manual mocking system can help to mock out the underlying implementation.</p>
<p>For example, if your code depends on a third party native video component called <code>react-native-video</code> you might want to stub it out with a manual mock like this:</p>
<pre><code class="language-js">jest.mock(<span class="hljs-string">'react-native-video'</span>, () =&gt; <span class="hljs-string">'Video'</span>);
</code></pre>
<p>This will render the component as <code>&lt;Video {...props} /&gt;</code> with all of its props in the snapshot output.</p>
<p>Sometimes you need to provide a more complex manual mock. For example if you'd like to forward the prop types or static fields of a native component to a mock, you can return a different React component from a mock through this helper from jest-react-native:</p>
<pre><code class="language-js">jest.mock(<span class="hljs-string">'path/to/MyNativeComponent'</span>, () =&gt; {
  <span class="hljs-keyword">const</span> mockComponent = <span class="hljs-built_in">require</span>(<span class="hljs-string">'react-native/jest/mockComponent'</span>);
  <span class="hljs-keyword">return</span> mockComponent(<span class="hljs-string">'path/to/MyNativeComponent'</span>);
});
</code></pre>
<p>Or if you'd like to create your own manual mock, you can do something like this:</p>
<pre><code class="language-js">jest.mock(<span class="hljs-string">'Text'</span>, () =&gt; {
  <span class="hljs-keyword">const</span> RealComponent = <span class="hljs-built_in">require</span>.requireActual(<span class="hljs-string">'Text'</span>);
  <span class="hljs-keyword">const</span> React = <span class="hljs-built_in">require</span>(<span class="hljs-string">'React'</span>);
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Text</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    render() {
      <span class="hljs-keyword">return</span> React.createElement(<span class="hljs-string">'Text'</span>, <span class="hljs-keyword">this</span>.props, <span class="hljs-keyword">this</span>.props.children);
    }
  }
  Text.propTypes = RealComponent.propTypes;
  <span class="hljs-keyword">return</span> Text;
});
</code></pre>
<p>In other cases you may want to mock a native module that isn't a React component. The same technique can be applied. We recommend inspecting the native module's source code and logging the module when running a react native app on a real device and then modeling a manual mock after the real module.</p>
<p>If you end up mocking the same modules over and over it is recommended to define these mocks in a separate file and add it to the list of <code>setupFiles</code>.</p>
<h3><a class="anchor" name="require-react-native-before-the-test-renderer"></a>require react-native before the test renderer <a class="hash-link" href="#require-react-native-before-the-test-renderer">#</a></h3>
<p>Currently it is required to require react-native before loading the test renderer:</p>
<pre><code>import 'react-native';
// Require after react-native
import renderer from 'react-test-renderer';
</code></pre>
<h3><a class="anchor" name="providesmodule"></a><code>@providesModule</code> <a class="hash-link" href="#providesmodule">#</a></h3>
<p>If you'd like to use Facebook's <code>@providesModule</code> module system through an npm package, the default haste config option must be overwritten and npm modules must be added to <code>providesModuleNodeModules</code>:</p>
<pre><code class="language-json">"haste": {
  "defaultPlatform": "ios",
  "platforms": ["android", "ios"],
  "providesModuleNodeModules": [
    "react",
    "react-native",
    "my-awesome-module",
    "my-text-component"
  ]
},
</code></pre>
<p>If you'd like to test a different default platform or if you are building for other platforms, the <code>defaultPlatform</code> and <code>platforms</code> configuration option can be updated.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="tutorial-react.html">← Testing React Apps</a><a class="docs-next button" href="testing-frameworks.html">Testing Web Frameworks →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/jest/" class="nav-home"><img src="/jest/img/jest-outline.svg" alt="Jest" width="66" height="58"/></a><div><h5>Docs</h5><a href="/jest/docs/zh-Hans/getting-started.html">Getting Started</a><a href="/jest/docs/zh-Hans/snapshot-testing.html">Guides</a><a href="/jest/docs/zh-Hans/api.html">API Reference</a></div><div><h5>Community</h5><a href="/jest/zh-Hans/users.html">User Showcase</a><a href="https://stackoverflow.com/questions/tagged/jestjs" target="_blank">Stack Overflow</a><a href="https://discordapp.com/channels/102860784329052160/103622435865104384">Jest Chat</a><a href="https://twitter.com/fbjest" target="_blank">Twitter</a></div><div><h5>More</h5><a href="/jest/blog">Blog</a><a href="https://github.com/facebook/jest">GitHub</a><a class="github-button" href="https://github.com/facebook/jest" data-icon="octicon-star" data-count-href="/facebook/jest/stargazers" data-count-api="/repos/facebook/jest#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/jest/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2017 Facebook Inc.</section></footer></div><script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-44373548-17', 'auto');
              ga('send', 'pageview');
            </script><script>
              var search = docsearch({
                apiKey: '833906d7486e4059359fa58823c4ef56',
                indexName: 'jest',
                inputSelector: '#search_input_react'
              });
            </script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script></body></html>