<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Jest | Painless JavaScript Unit Testing</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="Jest | Painless JavaScript Unit Testing"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/jest/index.html"><meta property="og:image" content="http://facebook.github.io/jest/img/opengraph.png"><meta property="og:description" content="Painless JavaScript Unit Testing"><link rel="shortcut icon" href="/jest/img/favicon.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"><link rel="stylesheet" href="/jest/css/jest.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/jest/"><img src="/jest/img/jest_logo_nav.png">Jest</a><div class="nav-site-wrapper"><ul class="nav-site nav-site-internal"><li><a href="/jest/docs/tutorial.html#content" class="active">docs</a></li><li><a href="/jest/support.html#content" class="">support</a></li><li><a href="/jest/blog/#content" class="">blog</a></li></ul><div class="algolia-search-wrapper"><input id="algolia-doc-search" type="text" placeholder="Search docs..."></div><ul class="nav-site nav-site-external"><li><a href="https://github.com/facebook/jest" class="">GitHub</a></li></ul></div></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Quick Start</h3><ul><li><a style="margin-left:0;" class="" href="/jest/docs/getting-started.html#content">Getting Started</a></li><li><a style="margin-left:0;" class="active" href="/jest/docs/tutorial.html#content">Tutorial</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/tutorial-react.html#content">Tutorial – React</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/tutorial-async.html#content">Tutorial – Async</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/tutorial-jquery.html#content">Tutorial – jQuery</a></li></ul></div><div class="nav-docs-section"><h3>Core Concepts</h3><ul><li><a style="margin-left:0;" class="" href="/jest/docs/common-js-testing.html#content">Module Testing</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/automatic-mocking.html#content">Automatic Mocking</a></li></ul></div><div class="nav-docs-section"><h3>Reference</h3><ul><li><a style="margin-left:0;" class="" href="/jest/docs/api.html#content">API Reference</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/troubleshooting.html#content">Troubleshooting</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/mock-functions.html#content">Mock functions</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/manual-mocks.html#content">Manual mocks</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/timer-mocks.html#content">Timer mocks</a></li></ul></div></div><div class="inner-content"><a id="content"></a><a class="edit-page-link" href="https://github.com/facebook/jest/blob/master/docs/Tutorial.md" target="_blank">Edit on GitHub</a><h1>Tutorial</h1><div><p>To begin, let&#x27;s see how we might test the following function (borrowed from <a href="http://martinfowler.com/articles/asyncJS.html" target="_blank">this great article on testing asynchronous functions</a>). It does an Ajax request to get the current user as JSON, transforms this JSON into a new object, and passes it to the callback. Very typical code:</p><pre class="prism language-javascript">
<span spellcheck="true" class="token comment">// fetchCurrentUser.js</span>
<span class="token string">&#x27;use strict&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;jquery&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">parseJSON</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    loggedIn<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
    fullName<span class="token punctuation">:</span> user<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">&#x27; &#x27;</span> <span class="token operator">+</span> user<span class="token punctuation">.</span>lastName<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">fetchCurrentUser</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">&#x27;GET&#x27;</span><span class="token punctuation">,</span>
    url<span class="token punctuation">:</span> <span class="token string">&#x27;http://example.com/currentUser&#x27;</span><span class="token punctuation">,</span>
    success<span class="token punctuation">:</span> user <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token function">parseJSON</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> fetchCurrentUser<span class="token punctuation">;</span></pre><p>In order to write a test for this module, we need to create a <code>__tests__/</code>
directory where the file <code>fetchCurrentUser.js</code> is. In this folder, we create a
file called <code>fetchCurrentUser-test.js</code> and we write our test in it:</p><pre class="prism language-javascript">
<span spellcheck="true" class="token comment">// __tests__/fetchCurrentUser-test.js</span>
<span class="token string">&#x27;use strict&#x27;</span><span class="token punctuation">;</span>

jest<span class="token punctuation">.</span><span class="token function">unmock</span><span class="token punctuation">(</span><span class="token string">&#x27;../fetchCurrentUser.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#x27;fetchCurrentUser&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;calls into $.ajax with the correct params&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;jquery&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> fetchCurrentUser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;../fetchCurrentUser&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span spellcheck="true" class="token comment">// Call into the function we want to test</span>
    <span class="token keyword">const</span> dummyCallback <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">fetchCurrentUser</span><span class="token punctuation">(</span>dummyCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span spellcheck="true" class="token comment">// Now make sure that $.ajax was properly called during the previous</span>
    <span spellcheck="true" class="token comment">// 2 lines</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>ajax<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">&#x27;GET&#x27;</span><span class="token punctuation">,</span>
      url<span class="token punctuation">:</span> <span class="token string">&#x27;http://example.com/currentUser&#x27;</span><span class="token punctuation">,</span>
      success<span class="token punctuation">:</span> jasmine<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>Function<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>Jest uses Jasmine 2 by default. An introduction to Jasmine 2 can be found
<a href="http://jasmine.github.io/2.0/introduction.html" target="_blank">here</a>.</p><p>When Jest runs, it runs any tests found in <code>__tests__</code> directories within the
source tree.</p><p>The first line is very important: <code>jest.unmock(&#x27;../fetchCurrentUser.js&#x27;);</code>.
By default, Jest automatically makes all calls to <code>require()</code> return a mocked
version of the real module – so we need to tell Jest not to mock the file we
want to test or else <code>require(&#x27;../fetchCurrentUser&#x27;)</code> will return a mock.</p><p>In our first test, we want to confirm that calling <code>fetchCurrentUser()</code>
properly invokes <code>$.ajax()</code> with the parameters we expect. To do
this, we call <code>fetchCurrentUser()</code> with a dummy callback function, and
then inspect the <code>$.ajax</code> mock to verify that it was called with the
correct parameters.</p><p>Woohoo! We&#x27;ve written our first test. But we&#x27;re not quite done: We would still
like to test that the callback we are passing in is indeed called back when the
<code>$.ajax</code> request has completed. To test this, we can do the following:</p><pre class="prism language-javascript">
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;calls the callback when $.ajax requests are finished&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;jquery&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> fetchCurrentUser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;../fetchCurrentUser&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span spellcheck="true" class="token comment">// Create a mock function for our callback</span>
    <span class="token keyword">const</span> callback <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fetchCurrentUser</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span spellcheck="true" class="token comment">// Now we emulate the process by which `$.ajax` would execute its own</span>
    <span spellcheck="true" class="token comment">// callback</span>
    $<span class="token punctuation">.</span>ajax<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">[</span><span class="token number">0</span><span spellcheck="true" class="token comment">/*first call*/</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span spellcheck="true" class="token comment">/*first argument*/</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      firstName<span class="token punctuation">:</span> <span class="token string">&#x27;Bobby&#x27;</span><span class="token punctuation">,</span>
      lastName<span class="token punctuation">:</span> <span class="token string">&#x27;&quot;);DROP TABLE Users;--&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span spellcheck="true" class="token comment">// And finally we assert that this emulated call by `$.ajax` incurred a</span>
    <span spellcheck="true" class="token comment">// call back into the mock function we provided as a callback</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>callback<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">[</span><span class="token number">0</span><span spellcheck="true" class="token comment">/*first call*/</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span spellcheck="true" class="token comment">/*first arg*/</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      loggedIn<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
      fullName<span class="token punctuation">:</span> <span class="token string">&#x27;Bobby &quot;);DROP TABLE Users;--&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>In order for <code>fetchCurrentUser</code> to compute the result to be passed in to the
callback, <code>fetchCurrentUser</code> will call in to one of it&#x27;s dependencies: <code>$.ajax</code>.
Since Jest has mocked this dependency for us, it&#x27;s easy to inspect all of the
interactions with <code>$.ajax</code> that occurred during our test.</p><p>At this point, you might be wondering how Jest was able to decide what the mock
for the <code>jQuery</code> module should look like. The answer is simple: Jest secretly
requires the real module, inspects what it looks like, and then builds a mocked
version of what it saw. This is how Jest knew that there should be a <code>$.ajax</code>
property, and that that property should be a mock function.</p><p>In Jest, all mock functions have a <code>.mock</code> property that stores all the
interactions with the function. In the above case, we are reading from
<code>mock.calls</code>, which is an array that contains information about each time the
function was called, and what arguments each of those calls had.</p><p>Now it is time to see if it worked:</p><pre class="prism language-javascript">
<span class="token operator">&gt;</span> npm test
<span class="token punctuation">[</span>PASS<span class="token punctuation">]</span> jest<span class="token operator">/</span>examples<span class="token operator">/</span>__tests__<span class="token operator">/</span>fetchCurrentUser<span class="token operator">-</span>test<span class="token punctuation">.</span>js <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span>075s<span class="token punctuation">)</span></pre><p>Woohoo! That&#x27;s it, we just tested this asynchronous function. One thing to
notice is that the code we&#x27;ve written is entirely synchronous. This is one of
the strengths of using mock functions in this way: the code you write in tests
is always straightfoward and imperative, no matter if the code being tested is
synchronous or asynchronous.</p><p>The code for this example is available at <a href="https://github.com/facebook/jest/tree/master/examples/tutorial" target="_blank">examples/tutorial</a>.</p></div><div class="docs-prevnext"><a class="docs-next" href="tutorial-react.html#content">Next →</a></div></div></section><footer class="wrap"><div class="right">© 2016 Facebook Inc.</div></footer></div><div id="fb-root"></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-387204-10', 'facebook.github.io');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");

            docsearch({
              apiKey: '833906d7486e4059359fa58823c4ef56',
              indexName: 'jest',
              inputSelector: '#algolia-doc-search'
            });
          </script></body></html>