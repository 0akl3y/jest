<html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Jest | Painless JavaScript Unit Testing</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="Jest | Painless JavaScript Unit Testing"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/jest/index.html"><meta property="og:image" content="http://facebook.github.io/jest/img/opengraph.png"><meta property="og:description" content="Painless JavaScript Unit Testing"><link rel="shortcut icon" href="/jest/img/favicon.png"><link rel="stylesheet" href="/jest/css/jest.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/jest/"><img src="/jest/img/jest_logo_nav.png">Jest</a><ul class="nav-site"><li><a href="/jest/docs/tutorial.html#content" class="active">docs</a></li><li><a href="/jest/support.html" class="">support</a></li><li><a href="http://github.com/facebook/jest" class="">github</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Quick Start</h3><ul><li><a style="margin-left:0;" class="" href="/jest/docs/getting-started.html#content">Getting Started</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/tutorial.html#content">Tutorial</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/tutorial-jquery.html#content">Tutorial – jQuery</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/tutorial-coffeescript.html#content">Tutorial – CoffeeScript</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/tutorial-react.html#content">Tutorial – React</a></li></ul></div><div class="nav-docs-section"><h3>Core Concepts</h3><ul><li><a style="margin-left:0;" class="" href="/jest/docs/common-js-testing.html#content">CommonJS Testing</a></li><li><a style="margin-left:0;" class="active" href="/jest/docs/automatic-mocking.html#content">Automatic Mocking</a></li></ul></div><div class="nav-docs-section"><h3>Reference</h3><ul><li><a style="margin-left:0;" class="" href="/jest/docs/mock-functions.html#content">Mock functions</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/manual-mocks.html#content">Manual mocks</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/timer-mocks.html#content">Timer mocks</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/api.html#content">API Reference</a></li></ul></div></div><div class="inner-content"><a id="content"></a><h1>Automatic Mocking</h1><div><p>In order to write an effective unit test, you want to be able to isolate a unit of code and test only that unit – nothing else. It is fairly common and good practice to consider a module such a unit, and this is where Jest excels. Jest makes isolating a module from its dependencies extremely easy by automatically generating mocks for each of the module&#x27;s depenedencies and providing those mocks (rather than the real dependency modules) by default.</p><p>Let&#x27;s look at a concrete example:</p><div class="prism language-javascript"><span class="token comment" spellcheck="true">// CurrentUser.js
</span><span class="token keyword">var</span> userID <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  getID<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> userID<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  setID<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    userID <span class="token operator">=</span> id<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></div><div class="prism language-javascript"><span class="token comment" spellcheck="true">// login.js
</span><span class="token keyword">var</span> CurrentUser <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">&#x27;./CurrentUser.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>If we run <code>login.js</code> with node, Jest will not become involved at all and the program will execute as you&#x27;d normally expect. However, if you run a unit test for the <code>login.js</code> file, Jest takes over and modifies <code>require()</code> such that the code behaves in the following way:</p><div class="prism language-javascript"><span class="token keyword">var</span> CurrentUser <span class="token operator">=</span> <span class="token punctuation">{</span>
  getID<span class="token punctuation">:</span> jest<span class="token punctuation">.</span><span class="token function">genMockFunction<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  setID<span class="token punctuation">:</span> jest<span class="token punctuation">.</span><span class="token function">genMockFunction<span class="token punctuation">(</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></div><p>With this setup, you cannot accidentally rely on the implementation details of <code>CurrentUser.js</code> when testing <code>login.js</code> because all of the calls to the <code>CurrentUser</code> module are mocked. Additionally, testing becomes easier in practice because you don&#x27;t have to write any boilerplate in your tests to setup mock objects for the dependencies you don&#x27;t want to test.</p><h2><a class="anchor" name="how-does-it-work"></a>How does it work? <a class="hash-link" href="#how-does-it-work">#</a></h2><p>Jest actually implements its own version of the <code>require()</code> function in the testing environment. Jest&#x27;s custom <code>require()</code> function loads the real module, inspects what it looks like, and then makes a mocked version based on what it saw and returns that.</p><p>This means Jest is going to give you an object with the same shape as the real module, but with mocks for each of the exported values instead of the real values.</p><div class="prism language-javascript"><span class="token comment" spellcheck="true">// Single function
</span>jest<span class="token punctuation">.</span><span class="token function">genMockFromModule<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token operator">-</span><span class="token operator">&gt;</span> jest<span class="token punctuation">.</span><span class="token function">genMockFunction<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">
// Object
</span>jest<span class="token punctuation">.</span><span class="token function">genMockFromModule<span class="token punctuation">(</span></span><span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  c<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    d<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token punctuation">:</span> jest<span class="token punctuation">.</span><span class="token function">genMockFunction<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  c<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    d<span class="token punctuation">:</span> jest<span class="token punctuation">.</span><span class="token function">genMockFunction<span class="token punctuation">(</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></div><p>The automatic mocking system is also aware of classes/constructor functions with custom prototypes:</p><div class="prism language-javascript"><span class="token comment" spellcheck="true">// User.js
</span><span class="token keyword">function</span> <span class="token function">User<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
User<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>setName <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">
// createCouple.js
</span><span class="token keyword">var</span> User <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">&#x27;./User.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createCouple<span class="token punctuation">(</span></span>nameA<span class="token punctuation">,</span> nameB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> userA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  userA<span class="token punctuation">.</span><span class="token function">setName<span class="token punctuation">(</span></span>nameA<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> userB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  userB<span class="token punctuation">.</span><span class="token function">setName<span class="token punctuation">(</span></span>nameB<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>userA<span class="token punctuation">,</span> userB<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>export <span class="token operator">=</span> createCouple<span class="token punctuation">;</span></div><p>In this example, you can instantiate the mocked version of the constructor using <code>new</code> (just like you&#x27;d normally do), and all of the methods will also be mock functions as you would expect:</p><div class="prism language-javascript"><span class="token comment" spellcheck="true">// __tests__/createCouple-test.js
</span>jest<span class="token punctuation">.</span><span class="token function">dontMock<span class="token punctuation">(</span></span><span class="token string">&#x27;../createCouple.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> createCouple <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">&#x27;../createCouple.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> couple <span class="token operator">=</span> <span class="token function">createCouple<span class="token punctuation">(</span></span><span class="token string">&#x27;userA&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;userB&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect<span class="token punctuation">(</span></span>couple<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>setName<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual<span class="token punctuation">(</span></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect<span class="token punctuation">(</span></span>couple<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>setName<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual<span class="token punctuation">(</span></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>An interesting detail to note is that while functions in the prototype are
normally shared across all instances, mock functions are not – they are
generated for each instance.</p><h2><a class="anchor" name="conclusion"></a>Conclusion <a class="hash-link" href="#conclusion">#</a></h2><p>A good goal to aim for when designing a system is to provide an API that is easy to use for 90% of use cases, while leaving the ability to accomplish the last 10% as well. In the case of Jest, automated mocking solves the rather uninteresting (but common) task of writing boilerplate to generate mocks for the unit you are testing. However, it is still possible to have complete control over what is mocked and what is not by providing <code>jest.mock()</code> and <code>jest.dontMock()</code> APIs for customization.</p><p>Additionally, there are times where the automated mocking system isn&#x27;t able to generate a mock that&#x27;s sufficient enough for your needs. In these cases, you can <a href="/jest/docs/manual-mocks.html" target="">manually write a mock</a> that Jest should use (rather than trying to infer one itself).</p></div><div class="docs-prevnext"><a class="docs-next" href="mock-functions.html#content">Next →</a></div></div></section><footer class="wrap"><div class="right">© 2014 Facebook Inc.</div></footer></div><div id="fb-root"></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-387204-10', 'facebook.github.io');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
          </script></body></html>