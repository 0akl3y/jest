<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Automatic Mocking · Jest</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="Automatic Mocking · Jest"><meta property="og:type" content="website"><meta property="og:url" content="https://facebook.github.io/jest/index.html"><meta property="og:image" content="https://facebook.github.io/jest/img/opengraph.png"><meta property="og:description" content="In order to write an effective unit test, you want to be able to isolate a unit"><link rel="shortcut icon" href="/jest/img/favicon.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"><link rel="stylesheet" href="/jest/css/jest.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.020/css/hack.min.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/jest/"><img src="/jest/img/jest-outline.svg"><h2>Jest</h2></a><div class="navigationWrapper navigationSlider"><div class="navSlideout"><i class="menuExpand"><span></span><span></span><span></span></i></div><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/jest/docs/tutorial.html#content" class="active">Docs</a></li><li><a href="/jest/support.html#content" class="">Support</a></li><li><a href="/jest/blog/#content" class="">Blog</a></li><li><a href="https://github.com/facebook/jest" class="">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input id="search_input_react" type="text" placeholder="Search"></li></ul></nav><script>
          var triggers = document.getElementsByClassName('menuExpand');
          var navs = document.getElementsByClassName('navSlideout');
          for (var i=0; i < triggers.length; i++) {
            triggers[i].onclick = function() {
              for (var j=0; j < navs.length; j++) {
                navs[j].classList.toggle('navSlideoutActive');
                navs[j].nextSibling.classList.toggle('slidingNavActive');
              }
            };
          }
        </script></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><a href="/jest/docs/">Docs</a><i>›</i><span>Core Concepts</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Quick Start</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/getting-started.html#content">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/tutorial.html#content">Tutorial</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/tutorial-react.html#content">Tutorial – React</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/tutorial-async.html#content">Tutorial – Async</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/tutorial-webpack.html#content">Tutorial – Webpack</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/tutorial-jquery.html#content">Tutorial – jQuery</a></li></ul></div><div class="navGroup navGroupActive"><h3>Core Concepts</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/common-js-testing.html#content">Module Testing</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/jest/docs/automatic-mocking.html#content">Automatic Mocking</a></li></ul></div><div class="navGroup navGroupActive"><h3>Reference</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/api.html#content">API Reference</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/troubleshooting.html#content">Troubleshooting</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/mock-functions.html#content">Mock functions</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/manual-mocks.html#content">Manual mocks</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/timer-mocks.html#content">Timer mocks</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer documentContainer postContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link" href="https://github.com/facebook/jest/edit/master/docs/AutomaticMocking.md" target="_blank">Edit on GitHub</a><h1>Automatic Mocking</h1></header><article><div><p>In order to write an effective unit test, you want to be able to isolate a unit
of code and test only that unit – nothing else. It is fairly common and good
practice to consider a module such a unit, and this is where Jest excels. Jest
makes isolating a module from its dependencies extremely easy by automatically
generating mocks for each of the module&#x27;s dependencies and providing those mocks
(rather than the real dependency modules) by default.</p><p>Let&#x27;s look at a concrete example:</p><pre class="prism language-javascript">
<span spellcheck="true" class="token comment">// CurrentUser.js</span>
<span class="token keyword">let</span> userID <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> userID<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setID</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    userID <span class="token operator">=</span> id<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><pre class="prism language-javascript">
<span spellcheck="true" class="token comment">// login.js</span>
<span class="token keyword">const</span> CurrentUser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./CurrentUser.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>If we run <code>login.js</code> with node, Jest will not become involved at all and the
program will execute as you&#x27;d normally expect. However, if you run a unit test
for the <code>login.js</code> file, Jest takes over and modifies <code>require()</code> such that the
code behaves in the following way:</p><pre class="prism language-javascript">
<span class="token keyword">const</span> CurrentUser <span class="token operator">=</span> <span class="token punctuation">{</span>
  getID<span class="token punctuation">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  setID<span class="token punctuation">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><p>With this setup, you cannot accidentally rely on the implementation details of
<code>CurrentUser.js</code> when testing <code>login.js</code> because all of the calls to the
<code>CurrentUser</code> module are mocked. Additionally, testing becomes easier in
practice because you don&#x27;t have to write any boilerplate in your tests to
setup mock objects for the dependencies you don&#x27;t want to test.</p><h2><a class="anchor" name="how-does-it-work"></a>How does it work? <a class="hash-link" href="#how-does-it-work">#</a></h2><p>Jest actually implements its own version of the <code>require()</code> function in the
testing environment. Jest&#x27;s custom <code>require()</code> function loads the real module,
inspects what it looks like, and then makes a mocked version based on what it
saw and returns that.</p><p>This means Jest is going to give you an object with the same shape as the real
module, but with mocks for each of the exported values instead of the real
values.</p><p>The automatic mocking system is also aware of classes/constructor functions
with custom prototypes:</p><pre class="prism language-javascript">
<span spellcheck="true" class="token comment">// User.js</span>
<span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
User<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>setName <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span spellcheck="true" class="token comment">// createCouple.js</span>
<span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./User.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createCouple</span><span class="token punctuation">(</span>nameA<span class="token punctuation">,</span> nameB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> userA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  userA<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>nameA<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> userB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  userB<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>nameB<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>userA<span class="token punctuation">,</span> userB<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span><span class="token keyword">export</span> <span class="token operator">=</span> createCouple<span class="token punctuation">;</span></pre><p>In this example, you can instantiate the mocked version of the constructor
using <code>new</code> (just like you&#x27;d normally do), and all of the methods will also be
mock functions as you would expect:</p><pre class="prism language-javascript">
<span spellcheck="true" class="token comment">// __tests__/createCouple-test.js</span>
jest<span class="token punctuation">.</span><span class="token function">unmock</span><span class="token punctuation">(</span><span class="token string">&#x27;../createCouple.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> createCouple <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;../createCouple.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> couple <span class="token operator">=</span> <span class="token function">createCouple</span><span class="token punctuation">(</span><span class="token string">&#x27;userA&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;userB&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>couple<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>setName<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>couple<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>setName<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>An interesting detail to note is that while functions in the prototype are
normally shared across all instances, mock functions are not – they are
generated for each instance.</p><h2><a class="anchor" name="conclusion"></a>Conclusion <a class="hash-link" href="#conclusion">#</a></h2><p>A good goal to aim for when designing a system is to provide an API that is easy
to use for 90% of use cases, while leaving the ability to accomplish the last
10% as well. In the case of Jest, automated mocking solves the rather
uninteresting (but common) task of writing boilerplate to generate mocks for
the unit you are testing. However, it is still possible to have complete control
over what is mocked and what is not by providing <code>jest.mock()</code> and
<code>jest.unmock()</code> APIs for customization.</p><p>Additionally, there are times where the automated mocking system isn&#x27;t able to
generate a mock that&#x27;s sufficient enough for your needs. In these cases, you
can <a href="/jest/docs/manual-mocks.html" target="">manually write a mock</a> that Jest should use
(rather than trying to infer one itself).</p></div></article></div><div class="docs-prevnext"><a class="docs-next" href="api.html#content">Next →</a></div></div></div></div><div class="footerContainer"><div class="wrapper footerWrapper"><div class="footerBlocks"><div class="footerSection fbOpenSourceFooter"><svg class="facebookOSSLogoSvg" viewBox="0 0 1133.9 1133.9" x="0px" y="0px"><g><path class="logoRing outerRing" d="M 498.3 3.7 c 153.6 88.9 307.3 177.7 461.1 266.2 c 7.6 4.4 10.3 9.1 10.3 17.8 c -0.3 179.1 -0.2 358.3 0 537.4 c 0 8.1 -2.4 12.8 -9.7 17.1 c -154.5 88.9 -308.8 178.1 -462.9 267.5 c -9 5.2 -15.5 5.3 -24.6 0.1 c -153.9 -89.2 -307.9 -178 -462.1 -266.8 C 3 838.8 0 833.9 0 825.1 c 0.3 -179.1 0.2 -358.3 0 -537.4 c 0 -8.6 2.6 -13.6 10.2 -18 C 164.4 180.9 318.4 92 472.4 3 C 477 -1.5 494.3 -0.7 498.3 3.7 Z M 48.8 555.3 c 0 79.9 0.2 159.9 -0.2 239.8 c -0.1 10 3 15.6 11.7 20.6 c 137.2 78.8 274.2 157.8 411 237.3 c 9.9 5.7 17 5.7 26.8 0.1 c 137.5 -79.8 275.2 -159.2 412.9 -238.5 c 7.4 -4.3 10.5 -8.9 10.5 -17.8 c -0.3 -160.2 -0.3 -320.5 0 -480.7 c 0 -8.8 -2.8 -13.6 -10.3 -18 C 772.1 218 633.1 137.8 494.2 57.4 c -6.5 -3.8 -11.5 -4.5 -18.5 -0.5 C 336.8 137.4 197.9 217.7 58.8 297.7 c -7.7 4.4 -10.2 9.2 -10.2 17.9 C 48.9 395.5 48.8 475.4 48.8 555.3 Z"></path><path class="logoRing middleRing" d="M 184.4 555.9 c 0 -33.3 -1 -66.7 0.3 -100 c 1.9 -48 24.1 -86 64.7 -110.9 c 54.8 -33.6 110.7 -65.5 167 -96.6 c 45.7 -25.2 92.9 -24.7 138.6 1 c 54.4 30.6 108.7 61.5 162.2 93.7 c 44 26.5 67.3 66.8 68 118.4 c 0.9 63.2 0.9 126.5 0 189.7 c -0.7 50.6 -23.4 90.7 -66.6 116.9 c -55 33.4 -110.8 65.4 -167.1 96.5 c -43.4 24 -89 24.2 -132.3 0.5 c -57.5 -31.3 -114.2 -64 -170 -98.3 c -41 -25.1 -62.9 -63.7 -64.5 -112.2 C 183.5 621.9 184.3 588.9 184.4 555.9 Z M 232.9 556.3 c 0 29.5 0.5 59.1 -0.1 88.6 c -0.8 39.2 16.9 67.1 50.2 86.2 c 51.2 29.4 102.2 59.2 153.4 88.4 c 31.4 17.9 63.6 18.3 95 0.6 c 53.7 -30.3 107.1 -61.2 160.3 -92.5 c 29.7 -17.5 45 -44.5 45.3 -78.8 c 0.6 -61.7 0.5 -123.5 0 -185.2 c -0.3 -34.4 -15.3 -61.5 -44.9 -79 C 637.7 352.6 583 320.8 527.9 290 c -27.5 -15.4 -57.2 -16.1 -84.7 -0.7 c -56.9 31.6 -113.4 64 -169.1 97.6 c -26.4 15.9 -40.7 41.3 -41.1 72.9 C 232.6 491.9 232.9 524.1 232.9 556.3 Z"></path><path class="logoRing innerRing" d="M 484.9 424.4 c 69.8 -2.8 133.2 57.8 132.6 132 C 617 630 558.5 688.7 484.9 689.1 c -75.1 0.4 -132.6 -63.6 -132.7 -132.7 C 352.1 485 413.4 421.5 484.9 424.4 Z M 401.3 556.7 c -3.4 37.2 30.5 83.6 83 84.1 c 46.6 0.4 84.8 -37.6 84.9 -84 c 0.1 -46.6 -37.2 -84.4 -84.2 -84.6 C 432.2 472.1 397.9 518.3 401.3 556.7 Z"></path></g></svg><h2>Facebook Open Source</h2></div><div class="footerSection"><a class="footerLink" href="https://code.facebook.com/projects/" target="_blank">Open Source Projects</a><a class="footerLink" href="https://github.com/facebook/" target="_blank">GitHub</a><a class="footerLink" href="https://twitter.com/fbOpenSource" target="_blank">Twitter</a></div><div class="footerSection rightAlign"><a class="footerLink" href="https://github.com/facebook/jest" target="_blank">Contribute on GitHub</a></div></div></div></div></div><div id="fb-root"></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-387204-10', 'facebook.github.io');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");

            docsearch({
              apiKey: '833906d7486e4059359fa58823c4ef56',
              indexName: 'jest',
              inputSelector: '#search_input_react'
            });
          </script></body></html>