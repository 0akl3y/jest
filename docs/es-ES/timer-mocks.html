<html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/><title>Timer Mocks · Jest</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Timer Mocks · Jest"/><meta property="og:type" content="website"/><meta property="og:url" content="https://facebook.github.io/jest/index.html"/><meta property="og:description" content="Las funciones de temporizador nativo (es decir, `setTimeout`, `setInterval`, `clearTimeout`, `clearInterval`) son ideales para un entorno de test puesto que dependen del transcurso del tiempo real. Jest puede cambiar temporizadores con funciones que permiten controlar el paso del tiempo. [ gran Scott!](https://www.youtube.com/watch?v=5gVv10J4nio)"/><meta property="og:image" content="/jest/img/opengraph.png"/><link rel="shortcut icon" href="/jest/img/favicon/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="/jest/css/main.css"/><link rel="alternate" type="application/atom+xml" href="https://facebook.github.io/blog/atom.xml" title="Jest Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://facebook.github.io/blog/feed.xml" title="Jest Blog RSS Feed"/><script async="" defer="" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/jest/"><img class="logo" src="/jest/img/jest.svg"/><h2 class="headerTitle">Jest</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/jest/docs/es-ES/getting-started.html" target="_self">Documentación</a></li><li><a href="/jest/docs/es-ES/api.html" target="_self">API</a></li><li><a href="/jest/es-ES/help.html" target="_self">Ayuda</a></li><li><a href="/jest/blog" target="_self">Blog</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/jest/img/language.svg"/>Español</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/jest/en">English</a></li><li><a href="/jest/ja">日本語</a></li><li><a href="/jest/pt-BR">Português (Brasil)</a></li><li><a href="/jest/ro">Română</a></li><li><a href="/jest/ru">Русский</a></li><li><a href="/jest/uk">Українська</a></li><li><a href="/jest/zh-Hans">简体中文</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(){
          if(languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search"/></li><li><a href="https://github.com/facebook/jest" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Guides</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Introduction</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/getting-started.html">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/using-matchers.html">Using Matchers</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/asynchronous.html">Testing Asynchronous Code</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/setup-teardown.html">Setup and Teardown</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/mock-functions.html">Mock Functions</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/more-resources.html">More Resources</a></li></ul></div><div class="navGroup navGroupActive"><h3>API Reference</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/api.html">Globals</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/expect.html">Expect</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/mock-function-api.html">Mock Functions</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/jest-object.html">The Jest Object</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/configuration.html">Configuring Jest</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/cli.html">Jest CLI Options</a></li></ul></div><div class="navGroup navGroupActive"><h3>Framework Guides</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/tutorial-react.html">Testing React Apps</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/tutorial-react-native.html">Testing React Native Apps</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/testing-frameworks.html">Testing Web Frameworks</a></li></ul></div><div class="navGroup navGroupActive"><h3>Guides</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/snapshot-testing.html">Snapshot Testing</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/tutorial-async.html">An Async Example</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/jest/docs/es-ES/timer-mocks.html">Timer Mocks</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/manual-mocks.html">Manual Mocks</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/webpack.html">Using with webpack</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/migration-guide.html">Migrating to Jest</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/es-ES/troubleshooting.html">Troubleshooting</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Timer Mocks</h1></header><article><div><span><p>Las funciones de temporizador nativo (es decir, <code>setTimeout</code>, <code>setInterval</code>, <code>clearTimeout</code>, <code>clearInterval</code>) son ideales para un entorno de test puesto que dependen del transcurso del tiempo real. Jest puede cambiar temporizadores con funciones que permiten controlar el paso del tiempo. <a href="https://www.youtube.com/watch?v=5gVv10J4nio"> gran Scott!</a></p>
<pre><code class="language-javascript"><span class="hljs-comment">// timerGame.js</span>
<span class="hljs-meta">'use strict'</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timerGame</span>(<span class="hljs-params">callback</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Ready....go!'</span>);
  setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Times up -- stop!'</span>);
    callback &amp;&amp; callback();
  }, <span class="hljs-number">1000</span>);
}

<span class="hljs-built_in">module</span>.exports = timerGame;
</code></pre>
<pre><code class="language-javascript"><span class="hljs-comment">// __tests__/timerGame-test.js</span>
<span class="hljs-meta">'use strict'</span>;

jest.useFakeTimers();

test(<span class="hljs-string">'waits 1 second before ending the game'</span>, () =&gt; {
  <span class="hljs-keyword">const</span> timerGame = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../timerGame'</span>);
  timerGame();

  expect(setTimeout.mock.calls.length).toBe(<span class="hljs-number">1</span>);
  expect(setTimeout.mock.calls[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]).toBe(<span class="hljs-number">1000</span>);
});
</code></pre>
<p>Aquí habilitamos las falsas alarmas mediante una llamada a <code>jest.useFakeTimers();</code>. Esto mockea setTimeout y otras funciones de temporizador con funciones simuladas.</p>
<h2><a class="anchor" name="ejecutar-todos-los-temporizadores"></a>Ejecutar todos los temporizadores <a class="hash-link" href="#ejecutar-todos-los-temporizadores">#</a></h2>
<p>Otra prueba que podríamos querer escribir para este módulo es la que afirma que la devolución de la llamada se realiza después de 1 segundo. Para ello, vamos a utilizar control de temporizador de Jest APIs para adelantar la hora correcta en el medio de la prueba:</p>
<pre><code class="language-javascript">  test(<span class="hljs-string">'calls the callback after 1 second'</span>, () =&gt; {
    <span class="hljs-keyword">const</span> timerGame = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../timerGame'</span>);
    <span class="hljs-keyword">const</span> callback = jest.fn();

    timerGame(callback);

    <span class="hljs-comment">// At this point in time, the callback should not have been called yet</span>
    expect(callback).not.toBeCalled();

    <span class="hljs-comment">// Fast-forward until all timers have been executed</span>
    jest.runAllTimers();

    <span class="hljs-comment">// Now our callback should have been called!</span>
    expect(callback).toBeCalled();
    expect(callback.mock.calls.length).toBe(<span class="hljs-number">1</span>);
  });
</code></pre>
<h2><a class="anchor" name="ejecutar-temporizadores-pendientes"></a>Ejecutar temporizadores pendientes <a class="hash-link" href="#ejecutar-temporizadores-pendientes">#</a></h2>
<p>También hay escenarios donde se podría tener un temporizador recursivo, que es un contador de tiempo que establece un nuevo temporizador en su propio callback. Para éstos, corriendo todos los contadores de tiempo sería un bucle sin fin... por lo que algo como <code>jest.runAllTimers()</code> no es deseable. Para estos casos se podría utilizar <code>jest.runOnlyPendingTimers()</code>:</p>
<pre><code class="language-javascript"><span class="hljs-comment">// infiniteTimerGame.js</span>
<span class="hljs-meta">'use strict'</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">infiniteTimerGame</span>(<span class="hljs-params">callback</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Ready....go!'</span>);

  setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Times up! 10 seconds before the next game starts...'</span>);
    callback &amp;&amp; callback();

    <span class="hljs-comment">// Schedule the next game in 10 seconds</span>
    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      infiniteTimerGame(callback);
    }, <span class="hljs-number">10000</span>);

  }, <span class="hljs-number">1000</span>);
}

<span class="hljs-built_in">module</span>.exports = infiniteTimerGame;
</code></pre>
<pre><code class="language-javascript"><span class="hljs-comment">// __tests__/infiniteTimerGame-test.js</span>
<span class="hljs-meta">'use strict'</span>;

jest.useFakeTimers();

describe(<span class="hljs-string">'infiniteTimerGame'</span>, () =&gt; {
  test(<span class="hljs-string">'schedules a 10-second timer after 1 second'</span>, () =&gt; {
    <span class="hljs-keyword">const</span> infiniteTimerGame = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../infiniteTimerGame'</span>);
    <span class="hljs-keyword">const</span> callback = jest.fn();

    infiniteTimerGame(callback);

    <span class="hljs-comment">// At this point in time, there should have been a single call to</span>
    <span class="hljs-comment">// setTimeout to schedule the end of the game in 1 second.</span>
    expect(setTimeout.mock.calls.length).toBe(<span class="hljs-number">1</span>);
    expect(setTimeout.mock.calls[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]).toBe(<span class="hljs-number">1000</span>);

    <span class="hljs-comment">// Fast forward and exhaust only currently pending timers</span>
    <span class="hljs-comment">// (but not any new timers that get created during that process)</span>
    jest.runOnlyPendingTimers();

    <span class="hljs-comment">// At this point, our 1-second timer should have fired it's callback</span>
    expect(callback).toBeCalled();

    <span class="hljs-comment">// And it should have created a new timer to start the game over in</span>
    <span class="hljs-comment">// 10 seconds</span>
    expect(setTimeout.mock.calls.length).toBe(<span class="hljs-number">2</span>);
    expect(setTimeout.mock.calls[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]).toBe(<span class="hljs-number">10000</span>);
  });
});
</code></pre>
<h2><a class="anchor" name="advance-timers-by-time"></a>Advance Timers by Time <a class="hash-link" href="#advance-timers-by-time">#</a></h2>
<p>Another possibility is use <code>jest.advanceTimersByTime(msToRun)</code>. When this API is called, all timers are advanced by <code>msToRun</code> milliseconds. All pending &quot;macro-tasks&quot; that have been queued via setTimeout() or setInterval(), and would be executed during this timeframe, will be executed. Además si esas macro tareas programan nuevas macro tareas que se ejecutarían dentro del mismo plazo, aquellas se ejecutará hasta que no haya más macro-tareas restantes en la cola que debe realizarse dentro de los msToRun milisegundos.</p>
<pre><code class="language-javascript"><span class="hljs-comment">// timerGame.js</span>
<span class="hljs-meta">'use strict'</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timerGame</span>(<span class="hljs-params">callback</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Ready....go!'</span>);
  setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Times up -- stop!'</span>);
    callback &amp;&amp; callback();
  }, <span class="hljs-number">1000</span>);
}

<span class="hljs-built_in">module</span>.exports = timerGame;
</code></pre>
<pre><code class="language-javascript">it(<span class="hljs-string">'calls the callback after 1 second via advanceTimersByTime'</span>, () =&gt; {
  <span class="hljs-keyword">const</span> timerGame = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../timerGame'</span>);
  <span class="hljs-keyword">const</span> callback = jest.fn();

  timerGame(callback);

  <span class="hljs-comment">// At this point in time, the callback should not have been called yet</span>
  expect(callback).not.toBeCalled();

  <span class="hljs-comment">// Fast-forward until all timers have been executed</span>
  jest.advanceTimersByTime(<span class="hljs-number">1000</span>);

  <span class="hljs-comment">// Now our callback should have been called!</span>
  expect(callback).toBeCalled();
  expect(callback.mock.calls.length).toBe(<span class="hljs-number">1</span>);
});
</code></pre>
<p>Por último, en ocasiones puede ser útil en algunas pruebas para poder borrar todos los contadores de tiempo pendientes. Para ello, contamos con <code>jest.clearAllTimers()</code>.</p>
<p>El código de este ejemplo está disponible en: <a href="https://github.com/facebook/jest/tree/master/examples/timer">examples/timer</a>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="tutorial-async.html">← An Async Example</a><a class="docs-next button" href="manual-mocks.html">Manual Mocks →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/jest/" class="nav-home"><img src="/jest/img/jest-outline.svg" alt="Jest" width="66" height="58"/></a><div><h5>Docs</h5><a href="/jest/docs/es-ES/getting-started.html">Getting Started</a><a href="/jest/docs/es-ES/snapshot-testing.html">Guides</a><a href="/jest/docs/es-ES/api.html">API Reference</a></div><div><h5>Community</h5><a href="/jest/es-ES/users.html">User Showcase</a><a href="https://stackoverflow.com/questions/tagged/jestjs" target="_blank">Stack Overflow</a><a href="https://discordapp.com/channels/102860784329052160/103622435865104384">Jest Chat</a><a href="https://twitter.com/fbjest" target="_blank">Twitter</a></div><div><h5>More</h5><a href="/jest/blog">Blog</a><a href="https://github.com/facebook/jest">GitHub</a><a class="github-button" href="https://github.com/facebook/jest" data-icon="octicon-star" data-count-href="/facebook/jest/stargazers" data-count-api="/repos/facebook/jest#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/jest/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2017 Facebook Inc.</section></footer></div><script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-44373548-17', 'auto');
              ga('send', 'pageview');
            </script><script>
              var search = docsearch({
                apiKey: '833906d7486e4059359fa58823c4ef56',
                indexName: 'jest',
                inputSelector: '#search_input_react'
              });
            </script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script></body></html>