<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Jest | Painless JavaScript Unit Testing</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="Jest | Painless JavaScript Unit Testing"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/jest/index.html"><meta property="og:image" content="http://facebook.github.io/jest/img/opengraph.png"><meta property="og:description" content="Painless JavaScript Unit Testing"><link rel="shortcut icon" href="/jest/img/favicon.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"><link rel="stylesheet" href="/jest/css/jest.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/jest/"><img src="/jest/img/jest_logo_nav.png">Jest</a><div class="nav-site-wrapper"><ul class="nav-site nav-site-internal"><li><a href="/jest/docs/tutorial.html#content" class="active">docs</a></li><li><a href="/jest/support.html#content" class="">support</a></li><li><a href="/jest/blog/#content" class="">blog</a></li></ul><div class="algolia-search-wrapper"><input id="algolia-doc-search" type="text" placeholder="Search docs..."></div><ul class="nav-site nav-site-external"><li><a href="https://github.com/facebook/jest" class="">GitHub</a></li></ul></div></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Quick Start</h3><ul><li><a style="margin-left:0;" class="" href="/jest/docs/getting-started.html#content">Getting Started</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/tutorial.html#content">Tutorial</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/tutorial-react.html#content">Tutorial – React</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/tutorial-async.html#content">Tutorial – Async</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/tutorial-jquery.html#content">Tutorial – jQuery</a></li></ul></div><div class="nav-docs-section"><h3>Core Concepts</h3><ul><li><a style="margin-left:0;" class="active" href="/jest/docs/common-js-testing.html#content">Module Testing</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/automatic-mocking.html#content">Automatic Mocking</a></li></ul></div><div class="nav-docs-section"><h3>Reference</h3><ul><li><a style="margin-left:0;" class="" href="/jest/docs/api.html#content">API Reference</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/troubleshooting.html#content">Troubleshooting</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/mock-functions.html#content">Mock functions</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/manual-mocks.html#content">Manual mocks</a></li><li><a style="margin-left:0;" class="" href="/jest/docs/timer-mocks.html#content">Timer mocks</a></li></ul></div></div><div class="inner-content"><a id="content"></a><a class="edit-page-link" href="https://github.com/facebook/jest/blob/master/docs/CommonJSTesting.md" target="_blank">Edit on GitHub</a><h1>Module Testing</h1><div><p>Dependency Injection is a way to mock dependencies in order to make code
testable. In this article, we&#x27;re going to see how Jest achieves the same result
using a different approach.</p><h2><a class="anchor" name="what-is-the-problem"></a>What is the problem? <a class="hash-link" href="#what-is-the-problem">#</a></h2><p>The <a href="https://docs.angularjs.org/guide/unit-testing#dependency-injection" target="_blank">example</a>
that Angular documentation uses to justify Dependency Injection is the
following:</p><pre class="prism language-javascript">
<span class="token keyword">function</span> <span class="token function">doWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XHR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#x27;POST&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;http://facebook.github.io/jest/&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre><p>This function has a dependency on the <code>XHR</code> class and uses the global namespace
in order to get a reference to <code>XHR</code>. In order to mock this dependency, we have
to monkey patch the global object.</p><pre class="prism language-javascript">
<span class="token keyword">let</span> oldXHR <span class="token operator">=</span> XHR<span class="token punctuation">;</span>
XHR <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">MockXHR</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">doWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span spellcheck="true" class="token comment">// assert that MockXHR got called with the right arguments</span>
XHR <span class="token operator">=</span> oldXHR<span class="token punctuation">;</span> <span spellcheck="true" class="token comment">// if you forget this bad things will happen</span></pre><p>This small example shows two important concepts. We need a way to get a
reference to <code>XHR</code> and a way to provide two implementations: one for the normal
execution and one for testing.</p><p>In this case, the solution to both concepts is to use the global object. It
works, but it&#x27;s not ideal for reasons outlined in this article:
<a href="http://misko.hevery.com/code-reviewers-guide/flaw-brittle-global-state-singletons/" target="_blank">Brittle Global State &amp; Singletons</a>.</p><h2><a class="anchor" name="how-does-angular-solve-this-problem"></a>How does Angular solve this problem? <a class="hash-link" href="#how-does-angular-solve-this-problem">#</a></h2><p>In Angular, you write your code by passing dependencies as arguments:</p><pre class="prism language-javascript">
<span class="token keyword">function</span> <span class="token function">doWork</span><span class="token punctuation">(</span>XHR<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XHR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#x27;POST&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;http://facebook.github.io/jest/&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre><p>It makes it very easy to write a test – you just pass your mocked version as
argument to your function:</p><pre class="prism language-javascript">
<span class="token keyword">const</span> MockXHR <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">doWork</span><span class="token punctuation">(</span>MockXHR<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span spellcheck="true" class="token comment">// assert that MockXHR got called with the right arguments</span></pre><p>But it&#x27;s a pain to thread these constructor arguments throughout a real
application. So Angular uses an <code>injector</code> behind the scenes. This makes it
easy to create instances that automatically acquire their dependencies:</p><pre class="prism language-javascript">
<span class="token keyword">const</span> injectedDoWork <span class="token operator">=</span> injector<span class="token punctuation">.</span><span class="token function">instantiate</span><span class="token punctuation">(</span>doWork<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span spellcheck="true" class="token comment">// is the equivalent of writing</span>

<span class="token keyword">function</span> <span class="token function">injectedDoWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> xhr <span class="token operator">=</span> injector<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&#x27;XHR&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#x27;POST&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;http://facebook.github.io/jest/&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre><p>Angular inspects the function and sees that it has one argument called <code>XHR</code>.
It then provides the value <code>injector.get(&#x27;XHR&#x27;)</code> for the variable <code>XHR</code>.</p><p>In order to have a testable function in Angular, you must conform to this
specific pattern and pass it into Angular&#x27;s DI framework before you can use it.</p><h2><a class="anchor" name="how-does-jest-solve-this-problem"></a>How does Jest solve this problem? <a class="hash-link" href="#how-does-jest-solve-this-problem">#</a></h2><p>Angular uses function arguments as a way to model dependencies and has to
implement its own module loader. Most large JavaScript applications already use
a module loader with the <code>require</code> function. In a CommonJS JavaScript app, the
example above would look more like this:</p><pre class="prism language-javascript">
<span class="token keyword">const</span> XHR <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;XHR&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">doWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XHR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#x27;POST&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;http://facebook.github.io/jest/&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre><p>The interesting aspect of this code is that the dependency on <code>XHR</code> is
marshalled by <code>require()</code>. The idea behind Jest is to use this as a seam for
inserting test doubles by implementing a special <code>require</code> in the testing
environment.</p><pre class="prism language-javascript">
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&#x27;XHR&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;XHR&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span spellcheck="true" class="token comment">// returns a mocked version of XHR</span>

jest<span class="token punctuation">.</span><span class="token function">unmock</span><span class="token punctuation">(</span><span class="token string">&#x27;XHR&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;XHR&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span spellcheck="true" class="token comment">// returns the real XHR module</span></pre><p>This allows you to write your tests like this:</p><pre class="prism language-javascript">
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&#x27;XHR&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span spellcheck="true" class="token comment">// note: by default, this is done automatically in Jest</span>
<span class="token function">doWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MockXHR <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;XHR&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span spellcheck="true" class="token comment">// assert that MockXHR got called with the right arguments</span></pre><h2><a class="anchor" name="conclusion"></a>Conclusion <a class="hash-link" href="#conclusion">#</a></h2><p>Dependency Injection is a very powerful tool that lets you swap the
implementation of any module at any time. However, the vast majority of code
only deals with one implementation for production and one for testing. Jest is
designed to make this common case much simpler to test.</p><p>Jest allows for mocking dependencies in the same way that Angular does, but
instead of building a proprietary module loader, it uses CommonJS. This enables
you to test any existing code that already uses CommonJS without having to
heavily refactor it to make it compatible with a another module system such as
Angular&#x27;s.</p><p>Fortunately, because Angular code has been designed for testing in any
environment, it is still possible to test Angular code using Jest.</p></div><div class="docs-prevnext"><a class="docs-next" href="automatic-mocking.html#content">Next →</a></div></div></section><footer class="wrap"><div class="right">© 2016 Facebook Inc.</div></footer></div><div id="fb-root"></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-387204-10', 'facebook.github.io');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");

            docsearch({
              apiKey: '833906d7486e4059359fa58823c4ef56',
              indexName: 'jest',
              inputSelector: '#algolia-doc-search'
            });
          </script></body></html>